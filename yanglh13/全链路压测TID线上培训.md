# 从小工到专家 微服务体系容量保障技术

---

**全链路压测**

## 数据库中间件改造

压测标识

## 应用服务改造

绕开逻辑限制  比如订单重复下单需要放开限制

数据隔离前置  压测数据不做报表统计、不计入风险规则

Mock模型

## 压测模型

### 读请求

压测场景  商家列表及关键字查询

压测方法  拉取线上日志，根据真实接口比例进行缩放

### 写请求

压测场景 用户下单

压测方法 用户、商户、商品数量进行等比例缩放

### 不准确（血的教训）

下单链路压测 用户没有使用红包 导致压测结果偏优

## 压测平台

jemeter C/S架构 

没有数据收集和展示，如何创建一个可视化的平台

1. 数据预处理 文件传入、分片（分布式）
2. 分配施压引擎并执行（时序数据库）
3. 执行结果传回
4. 实施监控

## 工具体系

准备阶段                          执行阶段                           反馈阶段
               
数据、脚本                         多阶段                         结果统计、问题统计

数据仓库（）线上日志/构造      压测引擎（分布式下发）                数据平台（统计信息）
                             监控组件（干预水位、熔断）

## 执行过程

## 周边

定期采集线上数据、按线上真实调用关系 数据等比例放大

技术手段 梳理压测量级与真实高峰期量级的比例差异 调整压测量

动态监控业务数据 识别链路变化 及时更新压测模型

## 全链路压测不是银弹

成本高

---

**搭上AI的翅膀-容量规划&预测**

经验 》 脑海中的模型 》 抽象分析 》 预测

## 什么是容量规划

预测未来负载水平合适会使系统饱和，以及一个尽可能延迟饱和的经济的过程

## 容量预测步骤

现状分析 》 特征提取 》 建模 》 交叉验证
                ||
               预测
                ||
             容量结果


现状分析： 组织保障 基础设施 预测目标 技术架构

## 模型拟合

## 准确性评价

**K-折交叉验证**

K = 7 

## Bad Case

依赖服务QPS激增，导致模型失效

数据未清洗，存在大量噪点

原始数据取值需要优化

样本过滤

## QPS与CPU的关联性（定性分析）

皮尔逊相关系数

### 对策

强相关 搜集样本 简历模型 推导输出

弱相关 特征选取 概率表

不相关 个例

#### 特征选取

目测法   过滤法   包裹法    嵌入法



